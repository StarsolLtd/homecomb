$('.flag-review-link').click(function() {
    var entityId = $(this).attr('data-entity-id');
    $('#flag-review-entity-id').val(entityId);
});

$('#flag-review-form').validate({
    submitHandler: function (form) {
        grecaptcha.ready(function() {
            grecaptcha.execute('{{ google_recaptcha_site_key }}', {action: 'submit'}).then(function(token) {
                const input = {
                    entityId: parseInt($('#flag-review-entity-id').val()),
                    entityName: $('#flag-review-entity-name').val(),
                    content: $('#flag-review-entity-content').val(),
                    googleReCaptchaToken: token
                };

                $.ajax(
                    {
                       type: 'POST',
                       url: '/api/flag',
                       data: JSON.stringify(input),
                       complete: function(output, status)
                       {
                           location.href = "{{ successUrl }}";
                       }
                     }
                );
            });
        });

        return false;
    }
});
